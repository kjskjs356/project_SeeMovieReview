{% extends 'base.html' %}
{% load static %}
{% load django_bootstrap5 %}

{% block content %}
<link rel="stylesheet" href="{% static './css/profile.css' %}">

<div class="out-layer">
  <div class="profile-div">
    <h2 class="text-center" style="font-family: 'Hanna', sans-serif;
    ">{{ person.username }}님의 프로필</h1>
    <br>
<<<<<<< HEAD
    <div class="follow-div" style="">
      팔로워 :<span id="followers-count">{{ person.followers.all|length }}</span>
      팔로잉 :<span id="followings-count">{{ person.followings.all|length }}<span>
    </div>
    <br>
=======
>>>>>>> 6506e30dc78db9b370f3681ca0220035bdc8dd52

    {% if request.user != person %}
    <div>
      <form id="follow-form" data-user-id={{ person.pk }}>
        {% csrf_token %}
        {% if request.user in person.followers.all %}
          <input type="submit" value="언팔로우">
        {% else %}
          <input type="submit" value="팔로우">
        {% endif %}
      </form>
    <div>
    {% endif %}


    <h5>{{ person.username }}님이 좋아하는 영화</h2>
    {% for movie in person.like_movies.all %}
      <div class='container'>
          <img src="https://image.tmdb.org/t/p/w500/{{ movie.poster_path }}" class="rounded like_img" alt="...">
      </div>
    {% endfor %}
    
    <a href="{% url 'accounts:update' %}">정보 수정</a>
    <a href="{% url 'movies:index' %}">뒤로 가기</a>
  </div>
</div>

{% endblock content %}

{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const form = document.querySelector('#follow-form')
    form.addEventListener('submit', function (event) {
      event.preventDefault()
      const userId = event.target.dataset.userId
      const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

      axios({
        method: 'post',
        url: `/accounts/${userId}/follow/`,
        headers: {'X-CSRFToken': csrftoken},
        // 1. url
        // 2. method
        // 3. csrf_token
      })
      .then((response) => {
        const isFollowed = response.data.is_followed
        const followBtn = document.querySelector('#follow-form > input[type=submit]')

        if (isFollowed === true) {
          followBtn.value = '언팔로우'
        } else {
          followBtn.value = '팔로우'
        }
        
        const followersCountTag = document.querySelector('#followers-count')
        const followingsCountTag = document.querySelector('#followings-count')

        const followersCount = response.data.followers_count
        const followingsCount = response.data.followings_count
        followersCountTag.innerText = followersCount 
        followingsCountTag.innerText = followingsCount
        })
        .catch((error) => {
          console.log(error)
        })
    })
  </script>

<<<<<<< HEAD

  <style>
    @import url(//fonts.googleapis.com/earlyaccess/hanna.css);
    
    .profile-div {
      max-width: 1200px;
      max-height: 3000px;
      padding: 35px;
      border: 5px solid #ddd;
      border-radius: 8px;
      }
    
    .out-layer {
      padding: 0;
      margin: 0;
      align-items: center;
      justify-content: center;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex-direcion: row;
    }

    .like_img {
      width: 100px;
      height: 150px;
    }
  </style>
  {% endblock script %}

{% comment %} CSRF 공식문서: https://docs.djangoproject.com/en/3.2/ref/csrf/#setting-the-token-on-the-ajax-request {% endcomment %}
=======
{% endblock script %}
>>>>>>> 6506e30dc78db9b370f3681ca0220035bdc8dd52
